{% extends 'core/base.html' %}
{% block title %}Fraud Prediction | FraudGuard AI{% endblock %}

{% block content %}
<div class="box">
    <h2>ğŸ” Fraud Prediction</h2>
    <p class="subtitle">Analyze individual transactions for potential fraud risk using machine learning</p>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="input-group">
            <span class="icon">â‚¹</span>
            <input type="number" name="amount" placeholder="Transaction Amount" step="0.01" required>
        </div>

        <div class="input-group">
            <span class="icon">ğŸ”¢</span>
            <input type="number" name="transactions" placeholder="Number of Transactions" required>
        </div>

        <div class="input-group">
            <span class="icon">â°</span>
            <input type="number" name="hour" placeholder="Hour (0â€“23)" min="0" max="23" required>
        </div>

        <button type="submit" class="button">Analyze Transaction</button>
    </form>

    {% if result %}
    <div class="divider"></div>

    <h3 style="margin-top: 0;">ğŸ“Š Model Predictions</h3>

    <div class="result {% if result.prediction_logistic == 'Fraud' %}fraud{% else %}normal{% endif %}"
        style="flex-direction: row; justify-content: space-between; align-items: center;">
        <span>ğŸ”¹ <b>Logistic Regression</b></span>
        <span><b>{{ result.prediction_logistic }}</b> ({{ result.accuracy_logistic }})</span>
    </div>

    <div class="result {% if result.prediction_dt == 'Fraud' %}fraud{% else %}normal{% endif %}"
        style="flex-direction: row; justify-content: space-between; align-items: center;">
        <span>ğŸ”¹ <b>Decision Tree</b></span>
        <span><b>{{ result.prediction_dt }}</b> ({{ result.accuracy_dt }})</span>
    </div>

    <div class="result {% if result.prediction_rf == 'Fraud' %}fraud{% else %}normal{% endif %}"
        style="flex-direction: row; justify-content: space-between; align-items: center;">
        <span>ğŸ”¹ <b>Random Forest</b></span>
        <span><b>{{ result.prediction_rf }}</b> ({{ result.accuracy_rf }})</span>
    </div>

    <div class="divider"></div>

    <div class="result {% if result.risk_level == 'High Risk' %}fraud{% elif result.risk_level == 'Medium Risk' %}warning{% else %}normal{% endif %}"
        style="text-align: center;">
        <h4 style="margin: 0 0 0.75rem 0;">ğŸ§  Final Risk Assessment</h4>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 0.5rem;">
            <div>
                <small style="opacity: 0.8;">Decision</small>
                <div style="font-weight: 700; font-size: 1rem;">{{ result.final_decision }}</div>
            </div>
            <div>
                <small style="opacity: 0.8;">Reason</small>
                <div style="font-weight: 700; font-size: 1rem;">{{ result.fraud_reason|default:"N/A" }}</div>
            </div>
            <div>
                <small style="opacity: 0.8;">Risk Level</small>
                <div style="font-weight: 700; font-size: 1rem;">{{ result.risk_level }}</div>
            </div>
            <div>
                <small style="opacity: 0.8;">Risk Score</small>
                <div style="font-weight: 700; font-size: 1rem;">{{ result.risk_score }}</div>
            </div>
        </div>
    </div>

    <div style="margin-top: 1.5rem;">
        <label style="font-weight: 600; margin-bottom: 0.5rem; display: block;">ğŸ“ˆ Risk Meter</label>
        <progress value="{{ result.risk_score }}" max="1"></progress>
    </div>

    <div class="risk-reason-box">
        <h4>ğŸ” Risk Factors</h4>
        <ul>
            <li>Transaction amount relative to normal patterns</li>
            <li>Number of transactions in session</li>
            <li>Time of day (late-night transactions)</li>
        </ul>
    </div>

    <a href="{% url 'home' %}" class="button secondary" style="margin-top: 1.5rem;">â¬… Back to Dashboard</a>
    {% endif %}
</div>
{% endblock %}