{% extends 'core/base.html' %}
{% block title %}Fraud Prediction | Fraud Detection System{% endblock %}

{% block content %}
<div class="box">

    <!-- Train Model Section -->
    <h2>ğŸ§  Train Fraud Detection Model</h2>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <label><b>Upload Training Dataset (CSV)</b></label>
            <input type="file" name="train_csv" required>
        </div>
        <button type="submit" class="button">Train Model</button>
    </form>

    {% if message %}
    <div class="success-message">âœ… {{ message }}</div>
    {% endif %}

    <div class="divider"></div>

    <!-- Prediction Section -->
    <h2>ğŸ” Fraud Prediction...!</h2>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="input-group">
            <span class="icon">â‚¹</span>
            <input type="number" name="amount" placeholder="Transaction Amount" step="0.01" required>
        </div>

        <div class="input-group">
            <span class="icon">ğŸ”¢</span>
            <input type="number" name="transactions" placeholder="Number of Transactions" required>
        </div>

        <div class="input-group">
            <span class="icon">â°</span>
            <input type="number" name="hour" placeholder="Hour (0â€“23)" min="0" max="23" required>
        </div>

        <button type="submit" class="button">Analyze Transaction</button>
    </form>

    {% if result %}
    <div class="result {% if result.prediction_logistic == 'Fraud' %}fraud{% else %}normal{% endif %}">
        ğŸ”¹ Logistic Regression: <b>{{ result.prediction_logistic }}</b>
        (Accuracy: {{ result.accuracy_logistic }})
    </div>

    <div class="result {% if result.prediction_dt == 'Fraud' %}fraud{% else %}normal{% endif %}">
        ğŸ”¹ Decision Tree: <b>{{ result.prediction_dt }}</b>
        (Accuracy: {{ result.accuracy_dt }})
    </div>

    <div class="result {% if result.prediction_rf == 'Fraud' %}fraud{% else %}normal{% endif %}">
        ğŸ”¹ Random Forest: <b>{{ result.prediction_rf }}</b>
        (Accuracy: {{ result.accuracy_rf }})
    </div>

    <div class="result {% if result.risk_level == 'High Risk' %}fraud
                               {% elif result.risk_level == 'Medium Risk' %}warning
                               {% else %}normal{% endif %}">
        ğŸ§  <b>Final Risk Assessment</b><br>
        Decision: <b>{{ result.final_decision }}</b><br>
        Risk Level: <b>{{ result.risk_level }}</b><br>
        Risk Score: <b>{{ result.risk_score }}</b>
    </div>

    <label style="margin-top: 1rem;"><b>Risk Meter</b></label>
    <progress value="{{ result.risk_score }}" max="1" style="width: 100%; height: 20px; border-radius: 8px;"></progress>

    <div class="risk-reason-box">
        <h4>ğŸ” Reason for Risk</h4>
        <ul>
            <li>Transaction amount is higher than usual</li>
            <li>Multiple transactions detected</li>
            <li>Late-night transaction hour</li>
        </ul>
    </div>

    <a href="{% url 'home' %}" class="button secondary" style="margin-top: 1.5rem;">â¬… Back to Homepage</a>
    {% endif %}

</div>
{% endblock %}